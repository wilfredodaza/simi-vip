"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var MStepper=function(){function e(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),_defineProperty(this,"_init",(function(){var e=n._formWrapperManager,t=n.options,i=n._methodsBindingManager,r=n._openAction,s=(0,n.getSteps)().steps;n.form=e(),r(s[t.firstActive],void 0,void 0,!0),i(s)})),_defineProperty(this,"_methodsBindingManager",(function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n.classes,s=n._formSubmitHandler,o=n._nextStepProxy,a=n._prevStepProxy,l=n._stepTitleClickHandler,c=n.form,p=n.options,d=e.addMultipleEventListeners,v=e.removeMultipleEventListeners,f=e.nodesIterator,u=e.tabbingDisabler,E=i?v:d,h=function(e){var t=e.getElementsByClassName(r.NEXTSTEPBTN),n=e.getElementsByClassName(r.PREVSTEPBTN),i=e.getElementsByClassName(r.STEPTITLE),d=e.querySelectorAll("input, select, textarea, button"),v=e.querySelectorAll('button[type="submit"]');return E(t,"click",o,!1),E(n,"click",a,!1),p.stepTitleNavigation&&E(i,"click",l),d.length&&E(d[d.length-1],"keydown",u),v&&c&&p.validationFunction&&E(v,"keydown",s),e};t instanceof Element?h(t):f(t,(function(e){return h(e)}))})),_defineProperty(this,"_formSubmitHandler",(function(e){n._validationFunctionCaller()||e.preventDefault()})),_defineProperty(this,"resetStepper",(function(){n.form&&(n.form.reset(),n.openStep(n.options.firstActive))})),_defineProperty(this,"updateStepper",(function(){var e=n._methodsBindingManager,t=(0,n.getSteps)().steps;e(t,!0),e(t)})),_defineProperty(this,"_openAction",(function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,s=n._slideDown,o=n.classes,a=n.getSteps,l=n._closeAction,c=n.stepper,p=n.events,d=n.options,v=a().active.step;if(v&&v.isSameNode(e))return e;var f=e.getElementsByClassName(o.STEPCONTENT)[0];return e.classList.remove(o.DONESTEP),window.innerWidth<993||!c.classList.contains(o.HORIZONTALSTEPPER)?(s(f,o.ACTIVESTEP,e,t),r||s(f,o.ACTIVESTEP,e,(function(){var e=f.querySelector("input, select, textarea");d.autoFocusInput&&e&&e.focus(),t&&"function"==typeof t&&t()}))):e.classList.add(o.ACTIVESTEP),v&&i&&(l(v),c.dispatchEvent(p.STEPCHANGE)),c.dispatchEvent(p.STEPOPEN),e})),_defineProperty(this,"_closeAction",(function(e,t){var i=n._slideUp,r=n.classes,s=n.stepper,o=n.events,a=n._smartListenerUnbind,l=n._smartListenerBind,c=e.getElementsByClassName(r.STEPCONTENT)[0];return window.innerWidth<993||!s.classList.contains(r.HORIZONTALSTEPPER)?i(c,r.ACTIVESTEP,e,t):(t&&l(c,"transitionend",(function e(n){"left"===n.propertyName&&(a(c,"transitionend",e),t())})),e.classList.remove(r.ACTIVESTEP)),s.dispatchEvent(o.STEPCLOSE),e})),_defineProperty(this,"_nextStepProxy",(function(e){return n.nextStep(void 0,void 0,e)})),_defineProperty(this,"_prevStepProxy",(function(e){return n.prevStep(void 0,e)})),_defineProperty(this,"_stepTitleClickHandler",(function(e){var t=n.classes,i=n.nextStep,r=n.prevStep,s=n.stepper,o=n._openAction,a=(0,n.getSteps)(),l=a.steps,c=a.active,p=e.target.closest(".".concat(t.STEP));if(s.classList.contains(t.LINEAR)){var d=Array.prototype.indexOf.call(l,p);d==c.index+1?i():d==c.index-1&&r()}else o(p)})),_defineProperty(this,"nextStep",(function(e,t,i){i&&i.preventDefault&&i.preventDefault();var r=n.options,s=n.getSteps,o=n.activateFeedback,a=n.form,l=n.wrongStep,c=n.classes,p=n._openAction,d=n.stepper,v=n.events,f=n.destroyFeedback,u=n._validationFunctionCaller,E=r.showFeedbackPreloader,h=r.validationFunction,y=s().active,P=s().steps[y.index+1],g=i&&i.target?i.target.dataset.feedback:null;return h&&!u()?l():g&&!t?(E&&!y.step.dataset.nopreloader&&o(),void window[g](f,a,y.step.querySelector(".".concat(c.STEPCONTENT)))):(y.step.classList.add(c.DONESTEP),p(P,e),void d.dispatchEvent(v.NEXTSTEP))})),_defineProperty(this,"prevStep",(function(e,t){t&&t.preventDefault&&t.preventDefault();var i=n.getSteps,r=n._openAction,s=n.stepper,o=n.events,a=n.destroyFeedback,l=i().active,c=i().steps[l.index+-1];a(),r(c,e),s.dispatchEvent(o.PREVSTEP)})),_defineProperty(this,"openStep",(function(e,t){var i=n._openAction,r=n.destroyFeedback,s=(0,n.getSteps)().steps[e];r(),i(s,t)})),_defineProperty(this,"wrongStep",(function(){var t=n.getSteps,i=n.classes,r=n.stepper,s=n.events;t().active.step.classList.add(i.WRONGSTEP);var o=t().active.step.querySelectorAll("input, select, textarea");e.addMultipleEventListeners(o,"input",(function n(){t().active.step.classList.remove(i.WRONGSTEP),e.removeMultipleEventListeners(o,"input",n)})),r.dispatchEvent(s.STEPERROR)})),_defineProperty(this,"activateFeedback",(function(){var e=n.classes,t=n.options,i=n.stepper,r=n.events,s=(0,n.getSteps)().active.step;s.classList.add(e.FEEDBACKINGSTEP),s.getElementsByClassName(e.STEPCONTENT)[0].insertAdjacentHTML("afterBegin",'<div class="'.concat(e.PRELOADERWRAPPER,'">').concat(t.feedbackPreloader,"</div>")),i.dispatchEvent(r.FEEDBACKING)})),_defineProperty(this,"destroyFeedback",(function(e){var t=n.classes,i=n.nextStep,r=n.stepper,s=n.events,o=(0,n.getSteps)().active.step;if(o&&o.classList.contains(t.FEEDBACKINGSTEP)){o.classList.remove(t.FEEDBACKINGSTEP);var a=o.getElementsByClassName(t.PRELOADERWRAPPER)[0];a.parentNode.removeChild(a),e&&i(void 0,!0),r.dispatchEvent(s.FEEDBACKDESTROYED)}})),_defineProperty(this,"getSteps",(function(){var e=n.stepper,t=n.classes,i=e.children,r=e.querySelector("li.".concat(t.STEP,".").concat(t.ACTIVESTEP));return{steps:i,active:{step:r,index:Array.prototype.indexOf.call(i,r)}}})),_defineProperty(this,"activateStep",(function(t,i){var r=n._slideDown,s=n.stepper,o=n._methodsBindingManager,a=e.nodesIterator,l=(0,n.getSteps)().steps,c=l.length>i,p=c?l[i]:l[l.length-1],d=null;return"string"==typeof t?(p.insertAdjacentHTML(c?"beforeBegin":"afterEnd",t.trim()),r(d=c?p.previousSibling:p.nextSibling)):Array.isArray(t)?(d=[],t.forEach((function(e){p.insertAdjacentHTML(c?"beforeBegin":"afterEnd",e.trim());var t=c?p.previousSibling:p.nextSibling;d.push(t),r(t)}))):(t instanceof Element||t instanceof HTMLCollection||t instanceof NodeList)&&(d=(c?s.insertBefore:s.appendChild)(t,p),t instanceof Element?r(d):a(d,(function(e){return r(e)}))),d&&o(d),d})),_defineProperty(this,"deactivateStep",(function(t){var i=n._slideUp,r=n.stepper,s=n._methodsBindingManager,o=e.nodesIterator,a=function(e){r.contains(t)&&(s(e,!0),i(e,void 0,void 0,(function(){return r.removeChild(e)})))};return t instanceof Element?a(t):(t instanceof HTMLCollection||t instanceof NodeList)&&o(t,(function(e){return a(e)})),t})),_defineProperty(this,"_slideDown",(function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=arguments.length>3?arguments[3]:void 0,o="".concat(e.getUnknownHeight(t),"px"),a=function i(r){"height"===r.propertyName&&(n._smartListenerUnbind(t,"transitionend",i),e.removeMultipleProperties(t,"visibility overflow height display"),s&&s())};return requestAnimationFrame((function(){t.style.display="none",requestAnimationFrame((function(){t.style.overflow="hidden",t.style.height="0",t.style.paddingBottom="0",t.style.visibility="unset",t.style.display="block",requestAnimationFrame((function(){n._smartListenerBind(t,"transitionend",a),t.style.height=o,t.style.removeProperty("padding-bottom"),i&&r.classList.add(i)}))}))})),t})),_defineProperty(this,"_slideUp",(function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,s=arguments.length>3?arguments[3]:void 0,o="".concat(t.offsetHeight,"px"),a=function i(r){"height"===r.propertyName&&(n._smartListenerUnbind(t,"transitionend",i),t.style.display="none",e.removeMultipleProperties(t,"visibility overflow height padding-bottom"),s&&s())};return requestAnimationFrame((function(){t.style.overflow="hidden",t.style.visibility="unset",t.style.display="block",t.style.height=o,requestAnimationFrame((function(){n._smartListenerBind(t,"transitionend",a),t.style.height="0",t.style.paddingBottom="0",i&&r.classList.remove(i)}))})),t})),_defineProperty(this,"_formWrapperManager",(function(){var e=n.stepper,t=n.options,i=e.closest("form");if(!i&&t.autoFormCreation){var r=e.dataset||{},s=r.method||"GET",o=r.action||"?",a=document.createElement("form");return a.method=s,a.action=o,e.parentNode.insertBefore(a,e),a.appendChild(e),a}return i&&i.length?i:null})),_defineProperty(this,"_validationFunctionCaller",(function(){var e=n.classes;return n.options.validationFunction(n.form,(0,n.getSteps)().active.step.querySelector(".".concat(e.STEPCONTENT)))})),_defineProperty(this,"_smartListenerBind",(function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=n.listenerStore,a={el:e,event:t,fn:i};if(r)for(var l=0;l<o.length;l++){var c=o[l];c.event===t&&c.el.isSameNode(e)&&c.el.removeEventListener(c.event,c.fn),s&&c.fn()}else{var p=o.indexOf(a);if(-1!==d){var d=o[p];d.el.removeEventListener(d.event,d.fn),s&&d[p].fn()}}e.addEventListener(t,i),o.push(a)})),_defineProperty(this,"_smartListenerUnbind",(function(e,t,i){var r=n.listenerStore,s=r.indexOf({el:e,event:t,fn:i});e.removeEventListener(t,i),r.splice(s,1)})),this.stepper=t,this.options=Object.assign({firstActive:0,autoFocusInput:!0,showFeedbackPreloader:!0,autoFormCreation:!0,validationFunction:e.defaultValidationFunction,stepTitleNavigation:!0,feedbackPreloader:'<div class="preloader-wrapper active"> <div class="spinner-layer spinner-blue-only"> <div class="circle-clipper left"> <div class="circle"></div></div><div class="gap-patch"> <div class="circle"></div></div><div class="circle-clipper right"> <div class="circle"></div></div></div></div>'},i),this.classes={HORIZONTALSTEPPER:"horizontal",LINEAR:"linear",NEXTSTEPBTN:"next-step",PREVSTEPBTN:"previous-step",STEPTITLE:"step-title",STEP:"step",STEPCONTENT:"step-content",PRELOADERWRAPPER:"wait-feedback",FEEDBACKINGSTEP:"feedbacking",ACTIVESTEP:"active",WRONGSTEP:"wrong",DONESTEP:"done"},this.events={STEPCHANGE:new Event("stepchange"),STEPOPEN:new Event("stepopen"),STEPCLOSE:new Event("stepclose"),NEXTSTEP:new Event("nextstep"),PREVSTEP:new Event("prevstep"),STEPERROR:new Event("steperror"),FEEDBACKING:new Event("feedbacking"),FEEDBACKDESTROYED:new Event("feedbackdestroyed")},this.listenerStore=[],this.form=null,this._init()}return _createClass(e,null,[{key:"addMultipleEventListeners",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e instanceof Element)return e.addEventListener(t,n,i);for(var r=0,s=e.length;r<s;r++)e[r].addEventListener(t,n,i)}},{key:"removeMultipleEventListeners",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e instanceof Element)return e.removeEventListener(t,n,i);for(var r=0,s=e.length;r<s;r++)e[r].removeEventListener(t,n,i)}},{key:"removeMultipleProperties",value:function(e,t){for(var n=t.split(" "),i=0;i<n.length;i++)e.style.removeProperty(n[i])}},{key:"nodesIterator",value:function(e,t){for(var n=0;n<e.length;n++)t(e[n]);return e}},{key:"getUnknownHeight",value:function(t){t.style.position="fixed",t.style.display="block",t.style.top="-999999px",t.style.left="-999999px",t.style.height="auto",t.style.opacity="0",t.style.zIndex="-999999",t.style.pointerEvents="none";var n=t.offsetHeight;return e.removeMultipleProperties(t,"position display top left height opacity z-index pointer-events"),n}},{key:"defaultValidationFunction",value:function(e,t){for(var n=t.querySelectorAll("input, textarea, select"),i=0;i<n.length;i++)if(!n[i].checkValidity())return!1;return!0}},{key:"tabbingDisabler",value:function(e){9===e.keyCode&&e.preventDefault()}}]),e}();window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t,n=(this.document||this.ownerDocument).querySelectorAll(e),i=this;do{for(t=n.length;--t>=0&&n.item(t)!==i;);}while(t<0&&(i=i.parentElement));return i}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=r[s])}return n},writable:!0,configurable:!0});